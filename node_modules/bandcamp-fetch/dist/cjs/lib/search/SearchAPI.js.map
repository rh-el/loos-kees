{"version":3,"file":"SearchAPI.js","sourceRoot":"","sources":["../../../../src/lib/search/SearchAPI.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA,6BAA0B;AAE1B,wDAA6C;AAC7C,sFAA2D;AAG3D,sGAAmH;AAEnH,IAAY,cAMX;AAND,WAAY,cAAc;IACxB,6BAAW,CAAA;IACX,uDAAqC,CAAA;IACrC,mCAAiB,CAAA;IACjB,mCAAiB,CAAA;IACjB,+BAAa,CAAA;AACf,CAAC,EANW,cAAc,8BAAd,cAAc,QAMzB;AASD,MAAqB,SAAU,SAAQ,oCAAuB;IAE5D,KAAK,CAAC,GAAG,CAAC,MAA6B;QACrC,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,MAAM,EAAE,QAAQ,EAAE,cAAc,CAAC,GAAG,EAAE,CAAC,CAAC;IAClE,CAAC;IAED,KAAK,CAAC,gBAAgB,CAAC,MAA6B;QAClD,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,MAAM,EAAE,QAAQ,EAAE,cAAc,CAAC,gBAAgB,EAAE,CAAC,CAAC;IAC/E,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,MAA6B;QACxC,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,MAAM,EAAE,QAAQ,EAAE,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC;IACrE,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,MAA6B;QACxC,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,MAAM,EAAE,QAAQ,EAAE,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC;IACrE,CAAC;IAED,KAAK,CAAC,IAAI,CAAC,MAA6B;QACtC,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,MAAM,EAAE,QAAQ,EAAE,cAAc,CAAC,IAAI,EAAE,CAAC,CAAC;IACnE,CAAC;IAUS,KAAK,CAAC,MAAM,CAAC,MAA4D;QACjF,MAAM,IAAI,GAAG;YACX,QAAQ,EAAE,MAAM,CAAC,QAAQ,IAAI,cAAc,CAAC,GAAG;YAC/C,gBAAgB,EAAE,MAAM,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,gBAAgB,EAAE,CAAC,CAAC;YAC3E,iBAAiB,EAAE,MAAM,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,iBAAiB,EAAE,EAAE,CAAC;SAC/E,CAAC;QACF,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC;QAC9D,OAAO,gCAAmB,CAAC,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IACtD,CAAC;IAED;;OAEG;IACO,MAAM,CAAC,YAAY,CAAC,MAA4D;QACxF,MAAM,MAAM,GAAG,IAAI,SAAG,CAAC,mBAAI,CAAC,MAAM,CAAC,CAAC;QACpC,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC;QAC3C,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC/D,QAAQ,MAAM,CAAC,QAAQ,EAAE,CAAC;YACxB,KAAK,cAAc,CAAC,gBAAgB;gBAClC,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;gBAC1C,MAAM;YACR,KAAK,cAAc,CAAC,MAAM;gBACxB,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;gBAC1C,MAAM;YACR,KAAK,cAAc,CAAC,MAAM;gBACxB,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;gBAC1C,MAAM;YACR,KAAK,cAAc,CAAC,IAAI;gBACtB,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;gBAC1C,MAAM;YACR,QAAQ;QACV,CAAC;QACD,OAAO,MAAM,CAAC,QAAQ,EAAE,CAAC;IAC3B,CAAC;CACF;AAhED,4BAgEC;AAED,MAAa,gBAAiB,SAAQ,SAAS;IAI7C,YAAY,MAA4D;QACtE,KAAK,CAAC,MAAM,CAAC,CAAC;QAHhB,4CAAkB;QAIhB,uBAAA,IAAI,6BAAY,MAAM,CAAC,OAAO,MAAA,CAAC;IACjC,CAAC;IAED,KAAK,CAAC,GAAG,CAAC,MAA6B;QACrC,OAAO,uBAAA,IAAI,iCAAS,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;IACzD,CAAC;IAED,KAAK,CAAC,gBAAgB,CAAC,MAA6B;QAClD,OAAO,uBAAA,IAAI,iCAAS,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC;IACtE,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,MAA6B;QACxC,OAAO,uBAAA,IAAI,iCAAS,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;IAC5D,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,MAA6B;QACxC,OAAO,uBAAA,IAAI,iCAAS,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;IAC5D,CAAC;IAED,KAAK,CAAC,IAAI,CAAC,MAA6B;QACtC,OAAO,uBAAA,IAAI,iCAAS,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;IAC1D,CAAC;CACF;AA5BD,4CA4BC","sourcesContent":["import { URL } from 'url';\nimport { type ImageFormat } from '../types/Image.js';\nimport { URLS } from '../utils/Constants.js';\nimport SearchResultsParser from './SearchResultsParser.js';\nimport { type SearchResultAlbum, type SearchResultAny, type SearchResultArtist, type SearchResultFan, type SearchResultLabel, type SearchResultTrack, type SearchResults } from '../types/Search.js';\nimport type Limiter from '../utils/Limiter.js';\nimport BaseAPIWithImageSupport, { type BaseAPIWithImageSupportParams } from '../common/BaseAPIWithImageSupport.js';\n\nexport enum SearchItemType {\n  All = 'All',\n  ArtistsAndLabels = 'ArtistsAndLabels',\n  Albums = 'Albums',\n  Tracks = 'Tracks',\n  Fans = 'Fans'\n}\n\nexport interface SearchAPISearchParams {\n  query: string;\n  page?: number;\n  albumImageFormat?: string | number | ImageFormat;\n  artistImageFormat?: string | number | ImageFormat;\n}\n\nexport default class SearchAPI extends BaseAPIWithImageSupport {\n\n  async all(params: SearchAPISearchParams) {\n    return this.search({ ...params, itemType: SearchItemType.All });\n  }\n\n  async artistsAndLabels(params: SearchAPISearchParams) {\n    return this.search({ ...params, itemType: SearchItemType.ArtistsAndLabels });\n  }\n\n  async albums(params: SearchAPISearchParams) {\n    return this.search({ ...params, itemType: SearchItemType.Albums });\n  }\n\n  async tracks(params: SearchAPISearchParams) {\n    return this.search({ ...params, itemType: SearchItemType.Tracks });\n  }\n\n  async fans(params: SearchAPISearchParams) {\n    return this.search({ ...params, itemType: SearchItemType.Fans });\n  }\n\n  /**\n   * @internal\n   */\n  protected async search(params: SearchAPISearchParams & { itemType: SearchItemType.ArtistsAndLabels }): Promise<SearchResults<SearchResultArtist | SearchResultLabel>>;\n  protected async search(params: SearchAPISearchParams & { itemType: SearchItemType.Albums }): Promise<SearchResults<SearchResultAlbum>>;\n  protected async search(params: SearchAPISearchParams & { itemType: SearchItemType.Tracks }): Promise<SearchResults<SearchResultTrack>>;\n  protected async search(params: SearchAPISearchParams & { itemType: SearchItemType.Fans }): Promise<SearchResults<SearchResultFan>>;\n  protected async search(params: SearchAPISearchParams & { itemType: SearchItemType.All }): Promise<SearchResults<SearchResultAny>>;\n  protected async search(params: SearchAPISearchParams & { itemType: SearchItemType }): Promise<any> {\n    const opts = {\n      itemType: params.itemType || SearchItemType.All,\n      albumImageFormat: await this.imageAPI.getFormat(params.albumImageFormat, 9),\n      artistImageFormat: await this.imageAPI.getFormat(params.artistImageFormat, 21)\n    };\n    const html = await this.fetch(SearchAPI.getSearchUrl(params));\n    return SearchResultsParser.parseResults(html, opts);\n  }\n\n  /**\n   * @internal\n   */\n  protected static getSearchUrl(params: SearchAPISearchParams & { itemType: SearchItemType }) {\n    const urlObj = new URL(URLS.SEARCH);\n    urlObj.searchParams.set('q', params.query);\n    urlObj.searchParams.set('page', (params.page || 1).toString());\n    switch (params.itemType) {\n      case SearchItemType.ArtistsAndLabels:\n        urlObj.searchParams.set('item_type', 'b');\n        break;\n      case SearchItemType.Albums:\n        urlObj.searchParams.set('item_type', 'a');\n        break;\n      case SearchItemType.Tracks:\n        urlObj.searchParams.set('item_type', 't');\n        break;\n      case SearchItemType.Fans:\n        urlObj.searchParams.set('item_type', 'f');\n        break;\n      default:\n    }\n    return urlObj.toString();\n  }\n}\n\nexport class LimiterSearchAPI extends SearchAPI {\n\n  #limiter: Limiter;\n\n  constructor(params: BaseAPIWithImageSupportParams & { limiter: Limiter }) {\n    super(params);\n    this.#limiter = params.limiter;\n  }\n\n  async all(params: SearchAPISearchParams): Promise<SearchResults<SearchResultAny>> {\n    return this.#limiter.schedule(() => super.all(params));\n  }\n\n  async artistsAndLabels(params: SearchAPISearchParams): Promise<SearchResults<SearchResultArtist | SearchResultLabel>> {\n    return this.#limiter.schedule(() => super.artistsAndLabels(params));\n  }\n\n  async albums(params: SearchAPISearchParams): Promise<SearchResults<SearchResultAlbum>> {\n    return this.#limiter.schedule(() => super.albums(params));\n  }\n\n  async tracks(params: SearchAPISearchParams): Promise<SearchResults<SearchResultTrack>> {\n    return this.#limiter.schedule(() => super.tracks(params));\n  }\n\n  async fans(params: SearchAPISearchParams): Promise<SearchResults<SearchResultFan>> {\n    return this.#limiter.schedule(() => super.fans(params));\n  }\n}\n"]}