{"version":3,"file":"ArticleListParser.js","sourceRoot":"","sources":["../../../../src/lib/article/ArticleListParser.ts"],"names":[],"mappings":"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","sourcesContent":["import { load as cheerioLoad } from 'cheerio';\nimport { type ArticleCategory, type ArticleList, type ArticleListItem } from '../types/Article.js';\nimport { URLS } from '../utils/Constants.js';\nimport { isAbsoluteUrl, normalizeUrl, reformatImageUrl, stripLineBreaks } from '../utils/Parse.js';\nimport { type ImageFormat } from '../types/Image.js';\n\ninterface ArticleListParseOptions {\n  imageFormat: ImageFormat | null;\n}\n\nexport default class ArticleListParser {\n\n  static parseList(html: string, opts: ArticleListParseOptions): ArticleList {\n    const $ = cheerioLoad(html);\n    const dailyUrl = URLS.DAILY;\n    const result: ArticleList = {\n      articles: [],\n      total: 0,\n      start: 0,\n      end: 0\n    };\n\n    $('articles-list').each((i, list) => {\n      $('.list-article', $(list)).each((i: number, article: any) => {\n        article = $(article);\n        const imgSrc = article.find('img').attr('src') || null;\n        // Category\n        const infoText = article.find('.article-info-text');\n        const infoTextCategoryLink = infoText.find('a.franchise');\n        const infoTextMiddot = infoText.find('.middot');\n        const categoryName = infoTextCategoryLink.text();\n        const category: ArticleCategory | null = categoryName ? {\n          name: categoryName\n        } : null;\n        const categoryUrl = infoTextCategoryLink.attr('href');\n        if (category && categoryUrl) {\n          category.url = isAbsoluteUrl(categoryUrl) ? categoryUrl : normalizeUrl(categoryUrl, dailyUrl);\n        }\n        // Date\n        infoTextCategoryLink.remove();\n        infoTextMiddot.remove();\n        const date = stripLineBreaks(infoText.text()).trim();\n        // Title and url\n        const titleLink = article.find('a.title');\n        const title = titleLink.text();\n        let url = titleLink.attr('href');\n        if (!isAbsoluteUrl(url)) {\n          url = normalizeUrl(url, dailyUrl);\n        }\n\n        if (titleLink) {\n          const parsed: ArticleListItem = {\n            url,\n            title,\n            date\n          };\n          if (category) {\n            parsed.category = category;\n          }\n          const imageUrl = reformatImageUrl(imgSrc, opts.imageFormat);\n          if (imageUrl) {\n            parsed.imageUrl = imageUrl;\n          }\n\n          result.articles.push(parsed);\n        }\n      });\n    });\n\n    const resultsText = stripLineBreaks($('#num-results').text()).trim();\n    const rtm = resultsText.match(/(\\d+)(?:\\s*to\\s*)(\\d+)(?:\\s*of\\s*)(\\d+)/);\n    if (rtm?.length === 4) {\n      result.total = parseInt(rtm[3], 10);\n      result.start = parseInt(rtm[1], 10);\n      result.end = parseInt(rtm[2], 10);\n    }\n\n    return result;\n  }\n}\n"]}