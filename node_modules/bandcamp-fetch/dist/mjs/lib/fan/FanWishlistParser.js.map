{"version":3,"file":"FanWishlistParser.js","sourceRoot":"","sources":["../../../../src/lib/fan/FanWishlistParser.ts"],"names":[],"mappings":"AAGA,OAAO,kBAAgD,MAAM,yBAAyB,CAAC;AAEvF,MAAM,CAAC,OAAO,OAAO,iBAAkB,SAAQ,kBAAkB;IAC/D,MAAM,CAAC,qBAAqB,CAAC,IAAY,EAAE,IAAyB;QAClE,OAAO,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE;YAC/B,GAAG,IAAI;YACP,OAAO,EAAE,UAAU;YACnB,WAAW,EAAE,IAAI,CAAC,iBAAiB;SACpC,CAAC,CAAC;IACL,CAAC;IAED,MAAM,CAAC,6BAA6B,CAAC,IAAS,EAAE,YAAkC,EAAE,IAAyB;QAC3G,OAAO,IAAI,CAAC,sBAAsB,CAAC,IAAI,EAAE,YAAY,EAAE;YACrD,GAAG,IAAI;YACP,OAAO,EAAE,OAAO;YAChB,WAAW,EAAE,IAAI,CAAC,iBAAiB;SACpC,CAAC,CAAC;IACL,CAAC;IAED,MAAM,CAAC,iBAAiB,CAAC,IAAS,EAAE,IAAyB,EAAE,UAAe;QAC5E,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,OAAO,IAAI,CAAC;QACd,CAAC;QAED,MAAM,iBAAiB,GAAG,CAAC,UAAe,EAAE,EAAU,EAAE,EAAE;YACxD,IAAI,CAAC,UAAU,IAAI,OAAO,UAAU,KAAK,QAAQ,EAAE,CAAC;gBAClD,OAAO,IAAI,CAAC;YACd,CAAC;YACD,KAAK,MAAM,MAAM,IAAI,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC;gBAC/C,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC;oBAC1B,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;oBACnD,IAAI,KAAK,EAAE,CAAC;wBACV,OAAO,KAAK,CAAC;oBACf,CAAC;gBACH,CAAC;YACH,CAAC;QACH,CAAC,CAAC;QAEF,IAAI,aAAuC,CAAC;QAC5C,QAAQ,IAAI,CAAC,YAAY,EAAE,CAAC;YAC1B,KAAK,GAAG;gBACN,aAAa,GAAG,OAAO,CAAC;gBACxB,MAAM;YACR,KAAK,GAAG;gBACN,aAAa,GAAG,OAAO,CAAC;gBACxB,MAAM;YACR;gBACE,aAAa,GAAG,IAAI,CAAC;QACzB,CAAC;QACD,IAAI,CAAC,aAAa,EAAE,CAAC;YACnB,OAAO,IAAI,CAAC;QACd,CAAC;QACD,MAAM,SAAS,GAAkB;YAC/B,IAAI,EAAE,aAAa;YACnB,EAAE,EAAE,IAAI,CAAC,OAAO;YAChB,IAAI,EAAE,IAAI,CAAC,UAAU;YACrB,GAAG,EAAE,IAAI,CAAC,QAAQ;YAClB,QAAQ,EAAE,EAAE;YACZ,MAAM,EAAE;gBACN,IAAI,EAAE,IAAI,CAAC,SAAS;aACrB;SACF,CAAC;QAEF,IAAI,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,EAAE,EAAE,EAAE,CAAC;YAC7C,SAAS,CAAC,QAAQ,GAAG,GAAG,IAAI,CAAC,YAAY,SAAS,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,EAAE,MAAM,CAAC;QAClG,CAAC;QACD,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,SAAS,IAAI,SAAS,CAAC,MAAM,EAAE,CAAC;YACnE,SAAS,CAAC,MAAM,CAAC,GAAG,GAAG,WAAW,IAAI,CAAC,SAAS,CAAC,SAAS,eAAe,CAAC;QAC5E,CAAC;QACD,MAAM,iBAAiB,GAAG,IAAI,CAAC,cAAc,KAAK,SAAS,CAAC,CAAC,CAAC,iBAAiB,CAAC,UAAU,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QACxH,IAAI,iBAAiB,EAAE,CAAC;YACtB,MAAM,QAAQ,GAAG,iBAAiB,CAAC,QAAQ,CAAC;YAC5C,MAAM,SAAS,GAAG,iBAAiB,CAAC,IAAI,EAAE,CAAC,SAAS,CAAC,CAAC;YACtD,MAAM,WAAW,GAAG,iBAAiB,CAAC,IAAI,EAAE,CAAC,QAAQ,CAAC,CAAC;YACvD,IAAI,aAAa,KAAK,OAAO,EAAE,CAAC;gBAC9B,MAAM,aAAa,GAAwB;oBACzC,EAAE,EAAE,iBAAiB,CAAC,EAAE;oBACxB,QAAQ,EAAE,iBAAiB,CAAC,YAAY;oBACxC,IAAI,EAAE,iBAAiB,CAAC,KAAK;oBAC7B,MAAM,EAAE,iBAAiB,CAAC,MAAM;oBAChC,QAAQ;oBACR,SAAS;iBACV,CAAC;gBACF,IAAI,WAAW,EAAE,CAAC;oBAChB,aAAa,CAAC,WAAW,GAAG,WAAW,CAAC;gBAC1C,CAAC;gBACA,SAAmB,CAAC,aAAa,GAAG,aAAa,CAAC;YACrD,CAAC;iBACI,CAAC;gBACH,SAAmB,CAAC,QAAQ,GAAG,QAAQ,CAAC;gBACxC,SAAmB,CAAC,SAAS,GAAG,SAAS,CAAC;gBAC3C,IAAI,WAAW,EAAE,CAAC;oBACf,SAAmB,CAAC,WAAW,GAAG,WAAW,CAAC;gBACjD,CAAC;YACH,CAAC;QACH,CAAC;QACD,OAAO,SAAS,CAAC;IACnB,CAAC;CACF","sourcesContent":["import type Album from '../types/Album.js';\nimport { type FanItemsContinuation } from '../types/Fan.js';\nimport type Track from '../types/Track.js';\nimport FanItemsBaseParser, { type FanItemParseOptions } from './FanItemsBaseParser.js';\n\nexport default class FanWishlistParser extends FanItemsBaseParser {\n  static parseWishlistFromPage(html: string, opts: FanItemParseOptions) {\n    return this.parsePageItems(html, {\n      ...opts,\n      dataKey: 'wishlist',\n      parseItemFn: this.parseWishlistItem\n    });\n  }\n\n  static parseWishlistFromContinuation(json: any, continuation: FanItemsContinuation, opts: FanItemParseOptions) {\n    return this.parseContinuationItems(json, continuation, {\n      ...opts,\n      dataKey: 'items',\n      parseItemFn: this.parseWishlistItem\n    });\n  }\n\n  static parseWishlistItem(data: any, opts: FanItemParseOptions, tracklists: any): Album | Track | null {\n    if (!data) {\n      return null;\n    }\n\n    const _findInTrackLists = (tracklists: any, id: number) => {\n      if (!tracklists || typeof tracklists !== 'object') {\n        return null;\n      }\n      for (const tracks of Object.values(tracklists)) {\n        if (Array.isArray(tracks)) {\n          const track = tracks.find((t: any) => t.id === id);\n          if (track) {\n            return track;\n          }\n        }\n      }\n    };\n\n    let mediaItemType: 'album' | 'track' | null;\n    switch (data.tralbum_type) {\n      case 'a':\n        mediaItemType = 'album';\n        break;\n      case 't':\n        mediaItemType = 'track';\n        break;\n      default:\n        mediaItemType = null;\n    }\n    if (!mediaItemType) {\n      return null;\n    }\n    const mediaItem: Album | Track = {\n      type: mediaItemType,\n      id: data.item_id,\n      name: data.item_title,\n      url: data.item_url,\n      imageUrl: '',\n      artist: {\n        name: data.band_name\n      }\n    };\n\n    if (data.item_art_id && opts.imageFormat?.id) {\n      mediaItem.imageUrl = `${opts.imageBaseUrl}/img/a${data.item_art_id}_${opts.imageFormat.id}.jpg`;\n    }\n    if (data.url_hints && data.url_hints.subdomain && mediaItem.artist) {\n      mediaItem.artist.url = `https://${data.url_hints.subdomain}.bandcamp.com`;\n    }\n    const featuredTrackData = data.featured_track !== undefined ? _findInTrackLists(tracklists, data.featured_track) : null;\n    if (featuredTrackData) {\n      const duration = featuredTrackData.duration;\n      const streamUrl = featuredTrackData.file?.['mp3-128'];\n      const streamUrlHQ = featuredTrackData.file?.['mp3-v0'];\n      if (mediaItemType === 'album') {\n        const featuredTrack: Omit<Track, 'type'> = {\n          id: featuredTrackData.id,\n          position: featuredTrackData.track_number,\n          name: featuredTrackData.title,\n          artist: featuredTrackData.artist,\n          duration,\n          streamUrl\n        };\n        if (streamUrlHQ) {\n          featuredTrack.streamUrlHQ = streamUrlHQ;\n        }\n        (mediaItem as Album).featuredTrack = featuredTrack;\n      }\n      else {\n        (mediaItem as Track).duration = duration;\n        (mediaItem as Track).streamUrl = streamUrl;\n        if (streamUrlHQ) {\n          (mediaItem as Track).streamUrlHQ = streamUrlHQ;\n        }\n      }\n    }\n    return mediaItem;\n  }\n}\n"]}